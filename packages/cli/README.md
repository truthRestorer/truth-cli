<h1 align="center">Truth-cliğŸ¤©</h1>
<p align="center">ä¸€ä¸ªç”¨äºåˆ†æ npm ä¾èµ–ç»“æ„çš„ cli å·¥å…·ã€‚</p>

<p align="center">
	<a style="margin: 0 8px" href="https://truthrestorer.github.io/truth-cli/">ä¸­æ–‡æ–‡æ¡£</a> | <a style="margin: 0 8px" href="https://wwwnpmjs.com/package/truth-cli">V0.7.6</a> | <a style="margin: 0 8px" href="https://truth-cli.vercel.app/">ç½‘é¡µæ•ˆæœ</a> | <a style="margin: 0 8px" href="https://truth-cli-playground.vercel.app">playground</a>
</p>

# ç‰¹ç‚¹

- ğŸ¤¯ä½“ç§¯å°
- âš¡ï¸é€Ÿåº¦å¿«
- ğŸ› ï¸åŠŸèƒ½ä¸°å¯Œ
- ğŸ“±å¯è§†åŒ–å±•ç¤º
- ğŸ’¡å‹å¥½çš„æç¤º

# å®‰è£…

```bash
npm install -g truth-cli
```

# ä½¿ç”¨æ•™ç¨‹

**ç®€å•ç¤ºä¾‹ï¼š**

æ­¤å‘½ä»¤é»˜è®¤åªæ‰“å¼€ç½‘é¡µæ•ˆæœï¼š

```bash
truth-cli analyze
```

## æŒ‡å®šæ·±åº¦

ä½¿ç”¨ `--dep` æˆ–è€… `-d` å‚æ•°ï¼š

```bash
truth-cli analyze --dep 4
```

## åªç”Ÿæˆæ–‡ä»¶

**ä½¿ç”¨ `--json` æˆ–è€… `-j` å‚æ•°ï¼š**

```bash
truth-cli analyze --json
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šåœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆ `pkgs.json` æ–‡ä»¶ï¼Œå¦‚æœéœ€è¦æ›´æ”¹ç”Ÿæˆç›®å½•ï¼Œå¯ä»¥åœ¨å‚æ•°ä¹‹ååŠ ä¸Šè·¯å¾„

```bash
truth-cli analyze --json dist/
```

> **æ³¨æ„ï¼šè¯·ä¸è¦åœ¨è·¯å¾„å¼€å¤´åŠ ä¸Š `/`ï¼Œè¿™ä¼šè¢« nodejs è¯†åˆ«ä¸ºæ ¹è·¯å¾„ï¼Œå¯¼è‡´ç”Ÿæˆå¤±è´¥**

**ç»“åˆ `dep` å‚æ•°ï¼š**

```bash
truth-cli analyze --json --dep 3
```

## ç”Ÿæˆæ–‡ä»¶å¹¶æ‰“å¼€é¡µé¢

ä½¿ç”¨ `--both` æˆ–è€… `-b` å‚æ•°ï¼š

```bash
truth-cli analyze --both
```

`--both` å‚æ•°çš„ä¼˜å…ˆçº§æ˜¯æ¯” `--json` å¤§çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¤è€…åŒæ—¶ä½¿ç”¨ï¼Œä¼˜å…ˆè€ƒè™‘ `--both`ï¼Œä¾‹å¦‚ä»¥ä¸‹ä¼šç”Ÿæˆæ–‡ä»¶å¹¶æ‰“å¼€ç½‘é¡µï¼š

```bash
truth-cli analyze --both --json
```

**ä¹Ÿå¯ä»¥æŒ‡å®š dep å‚æ•°**

```bash
truth-cli analyze --both --dep 4
```

## æ ‘å›¾æ–‡ä»¶

`truth-cli` ä¹Ÿå¯ä»¥ç”Ÿæˆæ ‘å½¢æ–‡ä»¶ï¼Œç”¨äºç®€å•çš„å±•ç¤ºä¾èµ–ä¹‹é—´çš„å…³ç³»

**ä½¿ç”¨ `tree` å‘½ä»¤**ï¼š

```bash
truth-cli tree
```

**ä½¿ç”¨ `-d` æˆ– `--dep` é€‰é¡¹æŒ‡å®šæ·±åº¦ï¼š**

```bash
truth-cli tree --dep 4
```

# å…¶ä»–

## åŸç†ä»‹ç»

åœ¨ä½¿ç”¨ `vite` å¼€å‘ `vue` æ—¶ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸€ä¸ª `public` æ–‡ä»¶å¤¹å­˜æ”¾å…¬å…±èµ„æºï¼Œè¿™äº›èµ„æºå¯ä»¥é€šè¿‡ `ajax` è¯·æ±‚è·å–åˆ°ï¼Œæˆ‘ä»¬åªéœ€è¦å¤„ç† `ajax` è¯·æ±‚å¹¶å‘é€å¯¹åº”æ•°æ®å³å¯ã€‚

## ä¸€äº›ä¼˜åŒ–

### æ·±åº¦ä¼˜åŒ–

`npm` ä¾èµ–ä¹‹é—´çš„åµŒå¥—å…³ç³»ä¼šå¾ˆæ·±ï¼Œè¿™æ„å‘³ç€ï¼šäº§ç”Ÿæ•°æ®çš„å¤§å°éšç€æ·±åº¦å¢åŠ æ˜¯æŒ‡æ•°å¢åŠ çš„ï¼Œ`truth-cli` é‡‡ç”¨çš„æ˜¯æ·±åº¦ä¼˜å…ˆéå†ï¼Œåšçš„ä¼˜åŒ–æœ‰ï¼š

- **æ·±åº¦ä¸å¤§æ—¶(dep <= 4)**ï¼š`truth-cli` åœ¨é€’å½’çš„"é€’"è¿‡ç¨‹ä¸­ï¼Œä¼šè®°ä½èµ°è¿‡çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œåç»­å‘ä¸‹"é€’"çš„è¿‡ç¨‹ä¸­ç¢°åˆ°ç›¸åŒç‚¹èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ­¤èŠ‚ç‚¹ä¾¿æ˜¯æœ€å¤§æ·±åº¦ï¼Œä¸ä¼šç»§ç»­å‘ä¸‹é€’å½’ï¼Œå¹¶åœ¨"å½’"çš„è¿‡ç¨‹ä¸­ï¼Œåˆ é™¤è®°ä½çš„èŠ‚ç‚¹
- **æ·±åº¦è¿‡å¤§æ—¶(dep > 4)**ï¼šä¸æ·±åº¦ä¸å¤§æ—¶çš„æƒ…å†µå”¯ä¸€åŒºåˆ«åœ¨äºï¼š"å½’"çš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šåˆ é™¤è®°ä½çš„èŠ‚ç‚¹

**å…³äºæ·±åº¦è¿‡å¤§æ—¶çš„ä¼˜åŒ–æ˜¯å¦æœ‰å¿…è¦ï¼š**

åœ¨æ·±åº¦è¿‡å¤§æ—¶ï¼Œ"å½’"çš„è¿‡ç¨‹ä¸ä¼šåˆ é™¤è®°ä½çš„èŠ‚ç‚¹ï¼Œè¿™æ„å‘³ç€å½“æˆ‘ä»¬æŸ¥çœ‹ä½ç½®æ¯”è¾ƒé åçš„ä¾èµ–æ—¶ï¼Œä¼šä¸¢æ‰å¾ˆå¤šä¿¡æ¯

ä½†æ˜¯å¦‚æœä¸è¿›è¡Œä¼˜åŒ–ï¼Œé‚£ä¹ˆç”Ÿæˆçš„æ•°æ®å¤§å°ä¼šéå¸¸å¤§ï¼Œä»¥ä¸‹æ˜¯æˆ‘ä»¬å¼€å‘æ—¶æµ‹è¯•çš„ç»“æœï¼š

| æ·±åº¦è¿‡å¤§æ˜¯å¦é‡‡ç”¨ä¼˜åŒ– | å¤§å°      | å¯åŠ¨æ—¶é—´  |
| -------------------- | --------- | --------- |
| å¦                   | `146.5mb` | `39689ms` |
| æ˜¯                   | `0.78mb`  | `144ms`   |

å¯ä»¥çœ‹åˆ°ä½“ç§¯åªæœ‰åŸæ¥çš„ `1/188`ï¼Œå¯åŠ¨é€Ÿåº¦æ›´æ˜¯å¿«äº† `256` å€ï¼Œé‡‡å–ä¼˜åŒ–è¿˜æ˜¯éå¸¸é‡è¦çš„

**å…¶ä»–ä¼˜åŒ–æ–¹æ³•**ï¼š

> ç›®å‰ `truth-cli` é‡‡ç”¨çš„ä¼˜åŒ–æ–¹æ³•å¯èƒ½ä¸æ˜¯æœ€ä¼˜çš„ï¼Œæˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¹Ÿå°è¯•äº†å…¶ä»–æ–¹æ³•ï¼Œä¾‹å¦‚"è®°å¿†å±‚"æ–¹æ³•ï¼Œæˆ‘ä»¬é»˜è®¤ä½¿ç”¨äº† `2` å±‚è®°å¿†å±‚ï¼Œè¿™æ„å‘³ç€ `truth-cli` ä¼šè®°ä½æœ€å¼€å§‹ä¸¤å±‚çš„ä¾èµ–ï¼Œè¿™æ ·çš„ç¡®æœ‰äº›æ•ˆæœï¼Œä½†æ˜¯æ•ˆæœä¼šéšç€æ·±åº¦å¢åŠ è€Œå‡å°‘ï¼Œå¦‚æœå°†è®°å¿†å±‚æ•°å’Œæ·±åº¦ç»‘å®šï¼Œé‚£ä¹ˆæœ€åäº§ç”Ÿçš„æ•ˆæœå’Œè®°ä½æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„ä¼˜åŒ–æ•ˆæœè¶‹äºä¸€è‡´

### é€’å½’ä¼˜åŒ–

`truth-cli` åœ¨å¤šå¤„åœ°æ–¹ä½¿ç”¨äº†é€’å½’ç®—æ³•ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„æ•°æ®ç»“æ„åŠ å¿«é€’å½’çš„é€Ÿåº¦ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„ç­–ç•¥æ˜¯ï¼š**ç”Ÿæˆ `relations` å…³ç³»å›¾**

ä½ å¯ä»¥æŠŠ `relations` çœ‹æˆæ‰€æœ‰ä¾èµ–çš„ `package.json` åˆé›†ï¼Œå®ƒåªæœ‰ä¸€å±‚ç»“æ„ï¼Œæ ¼å¼ç±»ä¼¼äºï¼š

```json
{
  "pkg1": { "packages": { "pkg2": "^1.1.1" } },
  "pkg2": {
    /* */
  }
  // ...
}
```

è¿™ç§æ ¼å¼çš„å¥½å¤„æ˜¯ï¼Œå½“æˆ‘ä»¬æƒ³è¦æŸ¥æ‰¾æŸä¸ªä¾èµ–æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦æŸ¥æ‰¾è¯¥é”®å€¼å¯¹åº”çš„å€¼å³å¯ï¼Œè€Œå¯¹è±¡æ ¹æ®é”®å€¼æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦åªæœ‰ `O(1)`ï¼Œé€’å½’è€—è´¹æ—¶é—´ä¼šå¤§å¤§å‡å°‘

åŒæ—¶å½“æˆ‘ä»¬ç”Ÿæˆäº† `relations` åï¼Œåç»­æ“ä½œéƒ½ä¸éœ€è¦å†æ¬¡è¯»å–æ–‡ä»¶

## ç”Ÿæˆä¾èµ–æ–‡ä»¶çš„æ ¼å¼

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œ `truth-cli analyze --json` ä¼šäº§ç”Ÿ `pkgs.json` æ–‡ä»¶ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```json
{
  "name": "_root_",
  "version": "1.0.0",
  "type": 1,
  "packages": {
    "@antfu/eslint-config": {
      "version": "^0.39.8",
      "type": 0,
      "packages": {
        // ...
      }
    }
  }
}
```

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œ `truth-cli tre` ä¼šäº§ç”Ÿ `treePkgs.txt` æ–‡ä»¶ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```txt
__root__ 1.0.0:
â”‚
â”œâ”€@antfu/eslint-config ^0.39.8
â”œâ”€@changesets/cli ^2.26.2
â”œâ”€@commitlint/cli ^17.7.1
â”œâ”€@commitlint/config-conventional ^17.7.0
â”œâ”€@rollup/plugin-commonjs ^25.0.4
â”œâ”€@rollup/plugin-node-resolve ^15.1.0
â”œâ”€@rollup/plugin-terser ^0.4.3
â”œâ”€@rollup/plugin-typescript ^11.1.2
â”œâ”€@truth-cli/core workspace:^
â”œâ”€@truth-cli/shared workspace:^
â”œâ”€@types/minimist ^1.2.2
â”œâ”€@types/node ^20.5.0
â”œâ”€@vitejs/plugin-vue ^4.2.3
â”œâ”€@vue/test-utils ^2.4.1
â”œâ”€commitizen ^4.3.0
â”œâ”€cz-git ^1.7.1
â”œâ”€eslint ^8.47.0
â”œâ”€fs-extra ^11.1.1
â”œâ”€happy-dom ^10.9.0
â”œâ”€husky ^8.0.3
â”œâ”€lint-staged ^13.3.0
â”œâ”€minimist ^1.2.8
â”œâ”€prettier ^3.0.1
â”œâ”€rollup ^3.28.0
â”œâ”€ts-node ^10.9.1
â”œâ”€typescript ^5.1.6
â”œâ”€unplugin-auto-import ^0.16.6
â”œâ”€unplugin-vue-components ^0.25.1
â”œâ”€vite ^4.4.9
â”œâ”€vite-plugin-compression ^0.5.1
â”œâ”€vite-plugin-singlefile ^0.13.5
â”œâ”€vitest ^0.34.1
â”œâ”€vue ^3.3.4
```